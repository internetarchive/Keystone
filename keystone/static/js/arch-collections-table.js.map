{"version":3,"file":"arch-collections-table.js","sources":["../../../../../web-components/src/archCollectionsTable/src/styles.ts","../../../../../web-components/src/archCollectionsTable/src/arch-collections-table.ts"],"sourcesContent":["import { css } from \"lit\";\n\nexport default [\n  css`\n    data-table > table {\n      table-layout: fixed;\n    }\n\n    data-table > table > thead > tr > th.type {\n      width: 5em;\n    }\n\n    data-table > table > thead > tr > th.public {\n      width: 5em;\n    }\n\n    data-table > table > thead > tr > th.dataset-date {\n      width: 7em;\n    }\n\n    data-table > table > thead > tr > th.size {\n      width: 7em;\n    }\n\n    data-table > table > thead > tr > th {\n      max-width: none;\n    }\n  `,\n];\n","import { PropertyValues } from \"lit\";\nimport { customElement } from \"lit/decorators.js\";\n\nimport { ArchDataTable } from \"../../archDataTable/index\";\nimport { CollectionTypeDisplayMap } from \"../../lib/constants\";\nimport {\n  Collection,\n  CollectionType,\n  CustomCollectionMetadata,\n  ProcessingState,\n} from \"../../lib/types\";\nimport { Topics } from \"../../lib/pubsub\";\nimport {\n  Paths,\n  humanBytes,\n  htmlAttrEscape as _,\n  isActiveProcessingState,\n  isoStringToDateString,\n} from \"../../lib/helpers\";\nimport Styles from \"./styles\";\n\n@customElement(\"arch-collections-table\")\nexport class ArchCollectionsTable extends ArchDataTable<Collection> {\n  static styles = [...ArchDataTable.styles, ...Styles];\n\n  willUpdate(_changedProperties: PropertyValues) {\n    super.willUpdate(_changedProperties);\n\n    this.actionButtonLabels = [\"Generate Dataset\", \"Create Custom Collection\"];\n    this.actionButtonSignals = [\n      Topics.GENERATE_DATASET,\n      Topics.CREATE_SUB_COLLECTION,\n    ];\n    this.apiCollectionEndpoint = \"/collections\";\n    this.apiItemResponseIsArray = true;\n    this.apiItemTemplate = \"/collections?id=:id\";\n    this.itemPollPredicate = (item) =>\n      item.collection_type === CollectionType.CUSTOM\n        ? isActiveProcessingState(\n            (item.metadata as CustomCollectionMetadata).state\n          )\n        : false;\n    this.itemPollPeriodSeconds = 3;\n\n    /* eslint-disable @typescript-eslint/restrict-template-expressions */\n    this.cellRenderers = [\n      (name, collection: Collection) => {\n        const nonRunningCustomValue = `\n            <a href=\"/collections/${_(collection.id.toString())}\" title=\"${_(\n          name as string\n        )}\">\n              <span class=\"highlightable\">${name}</span>\n            </a>\n        `;\n\n        if (collection.collection_type !== CollectionType.CUSTOM) {\n          return nonRunningCustomValue;\n        }\n\n        const { state } = collection.metadata as CustomCollectionMetadata;\n        if (state === ProcessingState.FINISHED) {\n          return nonRunningCustomValue;\n        }\n\n        return `\n            <span title=\"This Custom collection is in the process of being created\">${name} <i>(${\n          state === ProcessingState.RUNNING ? \"CREATING\" : state\n        })</i></span>\n        `;\n      },\n\n      (collectionType) =>\n        CollectionTypeDisplayMap[collectionType as CollectionType],\n\n      (isPublic) => `${isPublic ? \"Yes\" : \"No\"}`,\n\n      (lastJobName, collection: Collection) => {\n        if (lastJobName === null) {\n          return \"\";\n        }\n        lastJobName = lastJobName as string;\n        return `\n          <a href=\"${Paths.dataset(`${collection.latest_dataset.id}`)}\"\n             title=\"${_(lastJobName)}\">\n            ${lastJobName}\n          </a>\n        `;\n      },\n\n      (lastJobTime) =>\n        !lastJobTime ? \"\" : isoStringToDateString(lastJobTime as string),\n\n      (_, collection: Collection) =>\n        collection.collection_type === CollectionType.CUSTOM &&\n        (collection.metadata as CustomCollectionMetadata).state !==\n          ProcessingState.FINISHED\n          ? \"\"\n          : humanBytes(collection.size_bytes, 1),\n    ];\n    /* eslint-enable @typescript-eslint/restrict-template-expressions */\n\n    this.columnFilterDisplayMaps = [\n      undefined,\n      undefined,\n      { true: \"Yes\", false: \"No\" },\n    ];\n    this.columns = [\n      \"name\",\n      \"collection_type\",\n      \"metadata.is_public\",\n      \"latest_dataset.name\",\n      \"latest_dataset.start_time\",\n      \"size_bytes\",\n    ];\n    this.columnHeaders = [\n      \"Name\",\n      \"Type\",\n      \"Public\",\n      \"Latest Dataset\",\n      \"Dataset Date\",\n      \"Size\",\n    ];\n    this.selectable = true;\n    this.sort = \"-id\";\n    this.sortableColumns = [true, true, false, false, false, true];\n    this.filterableColumns = [false, true, true];\n    this.searchColumns = [\"name\"];\n    this.searchColumnLabels = [\"Name\"];\n    this.singleName = \"Collection\";\n    this.persistSearchStateInUrl = true;\n    this.pluralName = \"Collections\";\n  }\n\n  postSelectionChangeHandler(selectedRows: Array<Collection>) {\n    /* Update DataTable.actionButtonDisabled based on the number\n       of selected rows.\n    */\n    const { dataTable } = this;\n    const { props } = dataTable;\n    const numSelected = selectedRows.length;\n    const generateDatasetEnabled = numSelected === 1;\n    const createSubCollectionEnabled = true;\n    props.actionButtonDisabled = [\n      !generateDatasetEnabled,\n      !createSubCollectionEnabled,\n    ];\n    dataTable.setSelectionActionButtonDisabledState(numSelected === 0);\n  }\n\n  selectionActionHandler(action: string, selectedRows: Array<Collection>) {\n    switch (action) {\n      case Topics.GENERATE_DATASET:\n        window.location.href = Paths.generateCollectionDataset(\n          selectedRows[0].id\n        );\n        break;\n      case Topics.CREATE_SUB_COLLECTION:\n        window.location.href = Paths.buildSubCollection(\n          selectedRows.map((x) => x.id)\n        );\n    }\n  }\n}\n\n// Injects the tag into the global name space\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"arch-collections-table\": ArchCollectionsTable;\n  }\n}\n"],"names":["Styles","css","ArchCollectionsTable","ArchDataTable","willUpdate","_changedProperties","super","this","actionButtonLabels","actionButtonSignals","Topics","GENERATE_DATASET","CREATE_SUB_COLLECTION","apiCollectionEndpoint","apiItemResponseIsArray","apiItemTemplate","itemPollPredicate","item","collection_type","CollectionType","CUSTOM","isActiveProcessingState","metadata","state","itemPollPeriodSeconds","cellRenderers","name","collection","nonRunningCustomValue","_","id","toString","ProcessingState","FINISHED","RUNNING","collectionType","CollectionTypeDisplayMap","isPublic","lastJobName","Paths","dataset","latest_dataset","lastJobTime","isoStringToDateString","humanBytes","size_bytes","columnFilterDisplayMaps","undefined","true","false","columns","columnHeaders","selectable","sort","sortableColumns","filterableColumns","searchColumns","searchColumnLabels","singleName","persistSearchStateInUrl","pluralName","postSelectionChangeHandler","selectedRows","dataTable","props","numSelected","length","generateDatasetEnabled","actionButtonDisabled","setSelectionActionButtonDisabledState","selectionActionHandler","action","window","location","href","generateCollectionDataset","buildSubCollection","map","x","styles","__decorate","customElement"],"mappings":"omBAEA,IAAeA,EAAA,CACbC,CAAG;;;;;;;;;;;;;;;;;;;;;;;;KCmBE,IAAMC,EAAN,cAAmCC,EAGxCC,WAAWC,GACTC,MAAMF,WAAWC,GAEjBE,KAAKC,mBAAqB,CAAC,mBAAoB,4BAC/CD,KAAKE,oBAAsB,CACzBC,EAAOC,iBACPD,EAAOE,uBAETL,KAAKM,sBAAwB,eAC7BN,KAAKO,wBAAyB,EAC9BP,KAAKQ,gBAAkB,sBACvBR,KAAKS,kBAAqBC,GACxBA,EAAKC,kBAAoBC,EAAeC,QACpCC,EACGJ,EAAKK,SAAsCC,OAGpDhB,KAAKiB,sBAAwB,EAG7BjB,KAAKkB,cAAgB,CACnB,CAACC,EAAMC,KACL,MAAMC,EAAwB,uCACFC,EAAEF,EAAWG,GAAGC,uBAAuBF,EACjEH,mDAEkCA,uCAIpC,GAAIC,EAAWT,kBAAoBC,EAAeC,OAChD,OAAOQ,EAGT,MAAML,MAAEA,GAAUI,EAAWL,SAC7B,OAAIC,IAAUS,EAAgBC,SACrBL,EAGF,yFACuEF,SAC5EH,IAAUS,EAAgBE,QAAU,WAAaX,yBAElD,EAGFY,GACCC,EAAyBD,GAE1BE,GAAa,IAAGA,EAAW,MAAQ,MAEpC,CAACC,EAAaX,IACQ,OAAhBW,EACK,GAGF,wBACMC,EAAMC,QAAQ,GAAGb,EAAWc,eAAeX,+BAC1CD,EAAES,qBACVA,8BAKPI,GACEA,EAAmBC,EAAsBD,GAA3B,GAEjB,CAACb,EAAGF,IACFA,EAAWT,kBAAoBC,EAAeC,QAC7CO,EAAWL,SAAsCC,QAChDS,EAAgBC,SACd,GACAW,EAAWjB,EAAWkB,WAAY,IAI1CtC,KAAKuC,wBAA0B,MAC7BC,OACAA,EACA,CAAEC,KAAM,MAAOC,MAAO,OAExB1C,KAAK2C,QAAU,CACb,OACA,kBACA,qBACA,sBACA,4BACA,cAEF3C,KAAK4C,cAAgB,CACnB,OACA,OACA,SACA,iBACA,eACA,QAEF5C,KAAK6C,YAAa,EAClB7C,KAAK8C,KAAO,MACZ9C,KAAK+C,gBAAkB,EAAC,GAAM,GAAM,GAAO,GAAO,GAAO,GACzD/C,KAAKgD,kBAAoB,EAAC,GAAO,GAAM,GACvChD,KAAKiD,cAAgB,CAAC,QACtBjD,KAAKkD,mBAAqB,CAAC,QAC3BlD,KAAKmD,WAAa,aAClBnD,KAAKoD,yBAA0B,EAC/BpD,KAAKqD,WAAa,aACnB,CAEDC,2BAA2BC,GAIzB,MAAMC,UAAEA,GAAcxD,MAChByD,MAAEA,GAAUD,EACZE,EAAcH,EAAaI,OAC3BC,EAAyC,IAAhBF,EAE/BD,EAAMI,qBAAuB,EAC1BD,GACD,GAEFJ,EAAUM,sCAAsD,IAAhBJ,EACjD,CAEDK,uBAAuBC,EAAgBT,GACrC,OAAQS,GACN,KAAK7D,EAAOC,iBACV6D,OAAOC,SAASC,KAAOnC,EAAMoC,0BAC3Bb,EAAa,GAAGhC,IAElB,MACF,KAAKpB,EAAOE,sBACV4D,OAAOC,SAASC,KAAOnC,EAAMqC,mBAC3Bd,EAAae,KAAKC,GAAMA,EAAEhD,MAGjC,GA1IM5B,EAAM6E,OAAG,IAAI5E,EAAc4E,UAAW/E,GADlCE,EAAoB8E,EAAA,CADhCC,EAAc,2BACF/E"}