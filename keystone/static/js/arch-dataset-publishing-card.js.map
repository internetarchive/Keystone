{"version":3,"file":"arch-dataset-publishing-card.js","sources":["../../../../../web-components/src/archDatasetPublishingCard/src/styles.ts","../../../../../web-components/src/archDatasetPublishingCard/src/arch-dataset-publishing-card.ts"],"sourcesContent":["import { css } from \"lit\";\n\nimport { global, defaultButtonBgColor } from \"../../lib/styles\";\n\nexport default [\n  global,\n  css`\n    :host > div.container {\n      display: flex;\n    }\n\n    :host > div.container > div:first-child {\n      flex-grow: 1;\n    }\n\n    :host > div.container > button {\n      align-self: flex-start;\n    }\n\n    :host > div.container > button.cancel {\n      margin-right: 0.5rem;\n    }\n\n    h2 {\n      font-size: 1em;\n      margin: 0 0 0.75em 0;\n    }\n\n    /* Prevent items from overflow container: https://stackoverflow.com/a/66689926 */\n    div.detail {\n      min-width: 0;\n    }\n\n    div.metadata-display > dl,\n    div.metadata-display > arch-loading-indicator,\n    div.metadata-display > i {\n      margin-left: 2rem;\n    }\n\n    div.metadata-edit {\n      background-color: ${defaultButtonBgColor};\n      border-radius: 8px;\n      padding: 1rem 1.5rem;\n    }\n\n    dl > div,\n    dl > div:last-child {\n      margin-bottom: 0.75em;\n    }\n\n    [hidden] {\n      display: none;\n    }\n\n    div.form-buttons {\n      text-align: right;\n    }\n  `,\n];\n","import { LitElement, html } from \"lit\";\nimport { customElement, property, state, query } from \"lit/decorators.js\";\n\nimport { isoStringToDateString } from \"../../lib/helpers\";\nimport {\n  Dataset,\n  PublishedDatasetInfo,\n  PublishedDatasetMetadata,\n  PublishedDatasetMetadataApiResponse,\n  PublishedDatasetMetadataJSONSchema,\n  PublishedDatasetMetadataJSONSchemaProps,\n} from \"../../lib/types\";\nimport \"../../archLoadingIndicator/index\";\nimport \"../../archDatasetMetadataForm/index\";\nimport { ArchDatasetMetadataForm } from \"../../archDatasetMetadataForm/index\";\n\nimport styles from \"./styles\";\nimport * as _metadataSchema from \"../../archDatasetMetadataForm/src/schema.json\";\n\nconst metadataSchema = _metadataSchema as PublishedDatasetMetadataJSONSchema;\nconst propertiesOrder = metadataSchema.propertiesOrder as Array<string>;\n\nenum PublishState {\n  Loading = 0,\n  Unpublished,\n  PrePublish,\n  Publishing,\n  Published,\n  Unpublishing,\n}\n\nenum MetadataState {\n  Displaying,\n  Editing,\n  Saving,\n}\n\nconst orderedMetadataKeys = Object.keys(\n  metadataSchema.properties as object\n).sort((a, b) =>\n  propertiesOrder.indexOf(a) < propertiesOrder.indexOf(b) ? -1 : 1\n) as Array<keyof PublishedDatasetMetadata>;\n\nfunction getMetadataKeyTitle(k: keyof PublishedDatasetMetadata): string {\n  // Note that I can't figure out how to properly annotate metadataSchema.properties\n  // using something like PropertiesSchema from ajv/lib/types/json-schema.\n  return (metadataSchema.properties as PublishedDatasetMetadataJSONSchemaProps)[\n    k\n  ].title as string;\n}\n\n@customElement(\"arch-dataset-publishing-card\")\nexport class ArchDatasetPublishingCard extends LitElement {\n  @property({ type: String }) datasetId!: Dataset[\"id\"];\n  @property({ type: String }) csrfToken!: string;\n\n  @state() pubState: PublishState = PublishState.Loading;\n  @state() pubInfo: undefined | PublishedDatasetInfo = undefined;\n\n  @state() metadataState = MetadataState.Displaying;\n  @state() metadata: undefined | PublishedDatasetMetadataApiResponse =\n    undefined;\n\n  @query(\"arch-dataset-metadata-form\") metadataForm!: ArchDatasetMetadataForm;\n\n  static styles = styles;\n\n  connectedCallback() {\n    super.connectedCallback();\n    void this._fetchInitialData();\n  }\n\n  private get _metadataFormData() {\n    /* Return the metadata <form> inputs as an object with Array-type values. */\n    const metadata: PublishedDatasetMetadataApiResponse = {};\n    const metadataPairs = Array.from(\n      new FormData(this.metadataForm.form).entries()\n    )\n      // Remove empty string values.\n      .filter(([, v]) => (v as string).trim() !== \"\")\n      // Replace any tabs with \" \" and \"\\n\" with \"<br>\", which should only ever\n      // occur in the case of <textarea>.\n      .map(([k, v]) => [\n        k,\n        (v as string).replaceAll(\"\\t\", \" \").replaceAll(\"\\n\", \"<br>\"),\n      ]) as Array<[keyof PublishedDatasetMetadataApiResponse, string]>;\n\n    for (const [name, value] of metadataPairs) {\n      metadata[name] = (metadata[name] ?? []).concat(value);\n    }\n    return metadata;\n  }\n\n  // TODO - make this less complex\n  // eslint-disable-next-line complexity\n  render() {\n    const { pubState } = this;\n    if (pubState === PublishState.Loading) {\n      return html`<arch-loading-indicator></arch-loading-indicator>`;\n    }\n    const { metadata } = this;\n    const pubInfo = this.pubInfo as PublishedDatasetInfo;\n    return html`\n      <div class=\"container\">\n        <div class=\"detail\">\n          <dl>\n            <div>\n              <dt>Last Published</dt>\n              <dd>\n                ${pubState === PublishState.Published\n                  ? isoStringToDateString(pubInfo.time)\n                  : \"never\"}\n              </dd>\n            </div>\n            ${pubState !== PublishState.Published\n              ? html``\n              : html`\n                  <div>\n                    <dt>ARK</dt>\n                    <dd>\n                      <a href=\"https://ark.archive.org/${pubInfo.ark}\"\n                        >${pubInfo.ark}</a\n                      >\n                    </dd>\n                  </div>\n                `}\n          </dl>\n\n          <!-- Metadata section header -->\n          <h2>\n            ${pubState < PublishState.PrePublish ||\n            pubState === PublishState.Publishing\n              ? \"\"\n              : pubState === PublishState.PrePublish\n              ? html`<i>Enter Metadata</i>`\n              : \"Metadata\"}\n            ${pubState < PublishState.Published ||\n            this.metadataState === MetadataState.Editing\n              ? \"\"\n              : html`\n                  <button\n                    class=\"text\"\n                    @click=${() => (this.metadataState = MetadataState.Editing)}\n                  >\n                    (edit)\n                  </button>\n                `}\n          </h2>\n\n          <!-- Metadata display list -->\n          <div\n            class=\"metadata-display\"\n            ?hidden=${pubState < PublishState.Published ||\n            this.metadataState === MetadataState.Editing}\n          >\n            ${metadata === undefined\n              ? html`<arch-loading-indicator></arch-loading-indicator>`\n              : Object.keys(metadata).length === 0\n              ? html`<i>none</i>`\n              : html`\n                  <dl>\n                    ${orderedMetadataKeys\n                      .filter((k) => metadata[k] !== undefined)\n                      .map((k) => {\n                        const title = getMetadataKeyTitle(k);\n                        let values = metadata[k] as string | Array<string>;\n                        if (!Array.isArray(values)) {\n                          values = [values];\n                        }\n                        return html`\n                          <div>\n                            <dt>${title}</dt>\n                            ${values.map((value) => html`<dd>${value}</dd>`)}\n                          </div>\n                        `;\n                      })}\n                  </dl>\n                `}\n          </div>\n\n          <!-- Metadata edit form -->\n          <div\n            class=\"metadata-edit\"\n            ?hidden=${pubState !== PublishState.PrePublish &&\n            this.metadataState !== MetadataState.Editing &&\n            this.metadataState !== MetadataState.Saving}\n          >\n            ${pubState !== PublishState.PrePublish &&\n            this.metadataState !== MetadataState.Editing &&\n            this.metadataState !== MetadataState.Saving\n              ? html``\n              : html`\n                  <arch-dataset-metadata-form\n                    .schema=${_metadataSchema}\n                    .data=${metadata ?? {}}\n                  >\n                  </arch-dataset-metadata-form>\n                `}\n            <br />\n            <div\n              ?hidden=${pubState === PublishState.PrePublish}\n              class=\"form-buttons\"\n            >\n              <button\n                type=\"button\"\n                @click=${() => (this.metadataState = MetadataState.Displaying)}\n                ?disabled=${this.metadataState === MetadataState.Saving}\n              >\n                Cancel\n              </button>\n              <button\n                type=\"button\"\n                class=\"primary\"\n                @click=${() => this._saveMetadata()}\n                ?disabled=${this.metadataState === MetadataState.Saving}\n              >\n                ${this.metadataState === MetadataState.Saving\n                  ? html`<arch-loading-indicator\n                      style=\"--color: #fff\"\n                      text=\"Saving\"\n                    ></arch-loading-indicator>`\n                  : html`Save`}\n              </button>\n            </div>\n          </div>\n        </div>\n\n        <button\n          class=\"cancel\"\n          @click=${() => (this.pubState = PublishState.Unpublished)}\n          ?hidden=${pubState !== PublishState.PrePublish}\n        >\n          Cancel\n        </button>\n\n        <button\n          class=\"${pubState === PublishState.Unpublished\n            ? \"primary\"\n            : pubState === PublishState.PrePublish\n            ? \"success\"\n            : pubState === PublishState.Published\n            ? \"danger\"\n            : \"\"}\"\n          ?disabled=${pubState === PublishState.Publishing ||\n          pubState === PublishState.Unpublishing}\n          @click=${this._publishButtonClickHandler}\n        >\n          ${pubState === PublishState.Unpublished\n            ? \"Publish\"\n            : pubState === PublishState.PrePublish\n            ? \"Publish Now\"\n            : pubState === PublishState.Publishing\n            ? \"Publish in progress...\"\n            : pubState === PublishState.Published\n            ? \"Unpublish\"\n            : pubState === PublishState.Unpublishing\n            ? \"Unpublishing...\"\n            : \"\"}\n        </button>\n      </div>\n    `;\n  }\n\n  private async _fetchInitialData() {\n    // Fetch any existing publication info.\n    const pubInfo = await this._fetchPubInfo();\n    if (!pubInfo) {\n      // No publication job exists for this dataset.\n      this.pubState = PublishState.Unpublished;\n      this.metadata = {};\n      return;\n    }\n    // Check whether the job is in progress.\n    if (pubInfo.complete === false) {\n      this.pubState = PublishState.Publishing;\n      // Check again for published info in 3 seconds.\n      setTimeout(() => void this._fetchInitialData(), 3000);\n      return;\n    }\n    // Dataset has been published.\n    this.pubInfo = pubInfo;\n    this.pubState = PublishState.Published;\n    // Fetch the published metadata.\n    void this._pollItemMetadata();\n  }\n\n  private async _pollItemMetadata() {\n    /* Poll for the item metadata and save it once available. */\n    const { pubState } = this;\n    const pubInfo = this.pubInfo as PublishedDatasetInfo;\n    const metadata = await this._fetchItemMetadata(pubInfo.item);\n    if (metadata === undefined && pubState === PublishState.Published) {\n      // Try again in 3 seconds.\n      setTimeout(() => void this._pollItemMetadata(), 3000);\n    }\n    // Got it.\n    this.metadata = metadata;\n  }\n\n  private async _fetchPubInfo() {\n    /* Attempt to retrieve the info for any existing published dataset */\n    const { datasetId } = this;\n    const response = await fetch(`/api/datasets/${datasetId}/publication`);\n    if (response.status === 404) {\n      return undefined;\n    } else {\n      const pubInfo = (await response.json()) as PublishedDatasetInfo;\n      // Convert datetime string to Date.\n      pubInfo.time = new Date(pubInfo.time);\n      return pubInfo;\n    }\n  }\n\n  private async _fetchItemMetadata(itemId: PublishedDatasetInfo[\"item\"]) {\n    /* Attempt to retrieve the published item metadata */\n    const { datasetId } = this;\n    const response = await fetch(\n      `/api/datasets/${datasetId}/publication/${itemId}`\n    );\n    if (response.status === 404) {\n      return undefined;\n    }\n    return (await response.json()) as PublishedDatasetMetadataApiResponse;\n  }\n\n  private _publishButtonClickHandler() {\n    const metadataForm = this.metadataForm;\n    switch (this.pubState) {\n      case PublishState.Unpublished:\n        this.pubState = PublishState.PrePublish;\n        break;\n      case PublishState.PrePublish:\n        if (metadataForm.form.checkValidity()) {\n          void this._publish();\n        } else {\n          metadataForm.form.reportValidity();\n        }\n        break;\n      case PublishState.Published:\n        if (\n          window.confirm(\"Are you sure you want to unpublish this dataset?\")\n        ) {\n          void this._unpublish();\n        }\n        break;\n    }\n  }\n\n  private async _publish() {\n    const { csrfToken, datasetId, _metadataFormData: metadata } = this;\n    await fetch(`/api/datasets/${datasetId}/publication`, {\n      method: \"POST\",\n      credentials: \"same-origin\",\n      headers: { \"X-CSRFToken\": csrfToken },\n      mode: \"cors\",\n      body: JSON.stringify(metadata),\n    });\n    this.pubState = PublishState.Publishing;\n    // Start polling for pub info after a lengthy timeout in order to\n    // give the backend time to register the job.\n    setTimeout(() => void this._fetchInitialData(), 30000);\n  }\n\n  private async _unpublish() {\n    const { csrfToken, datasetId, pubInfo } = this;\n    const { item: itemId } = pubInfo as PublishedDatasetInfo;\n    this.pubState = PublishState.Unpublishing;\n    await fetch(`/api/datasets/${datasetId}/publication/${itemId}`, {\n      method: \"DELETE\",\n      credentials: \"same-origin\",\n      headers: { \"X-CSRFToken\": csrfToken },\n      mode: \"cors\",\n      body: JSON.stringify({ delete: true }),\n    });\n    this.pubState = PublishState.Unpublished;\n    // Call fetchInitialData to reset the component state.\n    void this._fetchInitialData();\n  }\n\n  private async _saveMetadata() {\n    const { csrfToken, datasetId, pubInfo, _metadataFormData: metadata } = this;\n    const { item: itemId } = pubInfo as PublishedDatasetInfo;\n    this.metadata = metadata;\n    this.metadataState = MetadataState.Saving;\n    // Add empty array values for all unspecified metadata fields in order to delete\n    // any existing values from the item.\n    const finalMetadata = Object.assign(\n      Object.fromEntries(orderedMetadataKeys.map((k) => [k, []])),\n      metadata\n    );\n    await fetch(`/api/datasets/${datasetId}/publication/${itemId}`, {\n      method: \"POST\",\n      credentials: \"same-origin\",\n      headers: { \"X-CSRFToken\": csrfToken },\n      mode: \"cors\",\n      body: JSON.stringify(finalMetadata),\n    });\n\n    this.metadataState = MetadataState.Displaying;\n  }\n}\n\n// Injects the tag into the global name space\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"arch-dataset-publishing-card\": ArchDatasetPublishingCard;\n  }\n}\n"],"names":["styles","global","css","defaultButtonBgColor","metadataSchema","_metadataSchema","propertiesOrder","PublishState","MetadataState","orderedMetadataKeys","Object","keys","properties","sort","a","b","indexOf","ArchDatasetPublishingCard","LitElement","constructor","this","pubState","Loading","pubInfo","undefined","metadataState","Displaying","metadata","connectedCallback","super","_fetchInitialData","_metadataFormData","metadataPairs","Array","from","FormData","metadataForm","form","entries","filter","v","trim","map","k","replaceAll","name","value","_a","concat","render","html","Published","isoStringToDateString","time","ark","PrePublish","Publishing","Editing","length","title","getMetadataKeyTitle","values","isArray","Saving","_saveMetadata","Unpublished","Unpublishing","_publishButtonClickHandler","async","_fetchPubInfo","complete","setTimeout","_pollItemMetadata","_fetchItemMetadata","item","datasetId","response","fetch","status","json","Date","itemId","checkValidity","_publish","reportValidity","window","confirm","_unpublish","csrfToken","method","credentials","headers","mode","body","JSON","stringify","delete","finalMetadata","assign","fromEntries","__decorate","property","type","String","prototype","state","query","customElement"],"mappings":"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"}