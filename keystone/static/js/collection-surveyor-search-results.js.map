{"version":3,"file":"collection-surveyor-search-results.js","sources":["../../../web-components/node_modules/@lit/reactive-element/decorators/state.js","../../../web-components/node_modules/@lit/reactive-element/decorators/base.js","../../../../../web-components/src/lib/api/fetch.ts","../../../../../web-components/src/lib/api/search.ts","../../../../../web-components/src/collectionSurveyorSearchResults/src/collection-surveyor-search-results.ts","../../../web-components/node_modules/@lit/reactive-element/decorators/event-options.js"],"sourcesContent":["import{property as r}from\"./property.js\";\n/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */function t(t){return r({...t,state:!0})}export{t as state};\n//# sourceMappingURL=state.js.map\n","/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\nconst e=(e,t,o)=>{Object.defineProperty(t,o,e)},t=(e,t)=>({kind:\"method\",placement:\"prototype\",key:t.key,descriptor:e}),o=({finisher:e,descriptor:t})=>(o,n)=>{var r;if(void 0===n){const n=null!==(r=o.originalKey)&&void 0!==r?r:o.key,i=null!=t?{kind:\"method\",placement:\"prototype\",key:n,descriptor:t(o.key)}:{...o,key:n};return null!=e&&(i.finisher=function(t){e(t,n)}),i}{const r=o.constructor;void 0!==t&&Object.defineProperty(o,n,t(n)),null==e||e(r,n)}};export{o as decorateProperty,e as legacyPrototypeMethod,t as standardPrototypeMethod};\n//# sourceMappingURL=base.js.map\n","const CSRF_REGEX = /csrftoken=([^;$]+)/;\n\nexport const getCsrfHeader = (): { \"X-CSRFToken\"?: string } => {\n  const csrfMatch = CSRF_REGEX.exec(decodeURIComponent(document.cookie));\n  if (!csrfMatch) {\n    return {};\n  }\n\n  return { \"X-CSRFToken\": csrfMatch[1] };\n};\n\nexport function callJsonApi<Rq, Rsp>(options: {\n  url: string;\n  method: \"GET\" | \"POST\" | \"PUT\" | \"PATCH\" | \"DELETE\";\n  errorMessage: string;\n  body?: Rq;\n}): Promise<Rsp> {\n  const request: RequestInit = {\n    method: options.method,\n    headers: {\n      ...getCsrfHeader(),\n      Accept: \"application/json\",\n      \"Content-Type\": \"application/json\",\n    },\n  };\n  if (options.body) {\n    request.body = JSON.stringify(options.body);\n  }\n  return (\n    fetch(options.url, request)\n      // cast response to generic response type\n      .then((response) => {\n        if (response.ok) {\n          return response.json().then((r) => r as Rsp);\n        } else {\n          throw new Error(options.errorMessage);\n        }\n      })\n      .catch((error) => {\n        console.error(error);\n        // log error, return no response\n        return Promise.reject(options.errorMessage);\n      })\n  );\n}\n","import { callJsonApi } from \"./fetch\";\nimport { SolrData } from \"../../lib/types\";\n\nexport const MAX_SOLR_ROWS = 14000;\n\nexport function constructFinalSearchTerm(\n  searchTerm: string,\n  parsedFilters: string[]\n) {\n  // if search term and no filters, just use search term (which could be an empty string)\n  if (parsedFilters.length === 0) {\n    return searchTerm;\n    // if one filter and no search term, use filter\n  } else if (searchTerm === \"\") {\n    return parsedFilters.join(\" AND \");\n    // if multiple filters and search term, join and use all values\n  } else {\n    return [...parsedFilters, searchTerm].join(\" AND \");\n  }\n}\n\nexport function callSearchApi(\n  finalSearchTerm: string,\n  rowCount: number\n): Promise<SolrData> {\n  return callJsonApi<undefined, SolrData>({\n    url: `/collection_surveyor/search/?q=${encodeURIComponent(\n      finalSearchTerm\n    )}&r=${encodeURIComponent(rowCount)}`,\n    method: \"GET\",\n    errorMessage: \"error in collection surveyor search\",\n  });\n}\n","import { html, css, LitElement, nothing } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators.js\";\nimport { eventOptions } from \"lit/decorators/event-options.js\";\n\nimport \"../../collectionSurveyorFacet/index\";\nimport \"../../collectionSurveyorPagination/index\";\nimport \"../../collectionSurveyorCart/index\";\nimport \"../../collectionSurveyorSearchBar/index\";\nimport \"../../collectionSurveyorActiveFilters/index\";\n\nimport {\n  CollectionSearchResult,\n  Facets,\n  CollectionAddToCartEventDetail,\n  CollectionSelectedDetail,\n  SelectedFacets,\n  SolrData,\n  CollectionRemovedFromCartDetail,\n} from \"../../lib/types\";\n\nimport {\n  humanBytes,\n  timestampStringToYearMonthString,\n} from \"../../lib/helpers\";\nimport {\n  callSearchApi,\n  constructFinalSearchTerm,\n  MAX_SOLR_ROWS,\n} from \"../../lib/api/search\";\n\n@customElement(\"collection-surveyor-search-results\")\nexport class CollectionSurveyorSearchResults extends LitElement {\n  @state() collections?: CollectionSearchResult[] = undefined;\n\n  @state() cachedCollections?: CollectionSearchResult[] = undefined;\n\n  @state() facets?: Facets = {};\n\n  @state() cachedFacets?: Facets = {};\n\n  // controls loading icon\n  // site is loading if we are getting the first itemsPerPage number of search results or loading remaining results in the background\n  @state() isLoading = false;\n\n  // controls when we display Total Results value for pagination, ie when we display'Page 1' or 'Page x of y (z Total Results)'\n  @state() backgroundCollectionsLoaded = false;\n\n  @state() collectionsSelected: {\n    [collectionName: string]: CollectionSelectedDetail;\n  } = {};\n\n  @state()\n  selectedFacets: SelectedFacets = {\n    f_organizationName: [],\n    f_organizationType: [],\n  };\n\n  @state() searchTerm = \"\";\n\n  @state() currentPage = 1;\n\n  @property({ type: Number }) itemsPerPage = 100;\n\n  connectedCallback() {\n    super.connectedCallback();\n    // load first itemsPerPage number of search results, then load remaining items and cache\n    this.loadSearchFirstPage()\n      .then(() => this.loadRemainingSearchResultsInBackgroundAndCacheData())\n      .catch((error) => {\n        throw error;\n      });\n  }\n\n  private get collectionsLength() {\n    return this.collections ? this.collections.length : 0;\n  }\n\n  private get startIndex(): number {\n    return (this.currentPage - 1) * this.itemsPerPage;\n  }\n\n  private get endIndex(): number {\n    return this.startIndex + this.itemsPerPage;\n  }\n\n  private get paginatedResults() {\n    return this.collections?.slice(this.startIndex, this.endIndex);\n  }\n\n  // event handler for selecting/deselecting a collection\n  handleUpdateCollectionsSelected(event: CustomEvent) {\n    const {\n      collectionSize,\n      collectionName,\n      collectionId,\n      organizationName,\n      createdDt,\n    }: CollectionAddToCartEventDetail =\n      event.detail as CollectionAddToCartEventDetail;\n\n    if (!(collectionName in this.collectionsSelected)) {\n      const sizeIdMap: CollectionSelectedDetail = {\n        collectionSize: collectionSize,\n        collectionId: collectionId,\n        organizationName: organizationName,\n        createdDt: createdDt,\n      };\n\n      // create a new collectionsSelected object with the existing selected collections plus the latest selected collection\n      this.collectionsSelected = {\n        ...this.collectionsSelected,\n        [collectionName]: sizeIdMap,\n      };\n    } else {\n      this.removeCollectionFromCollectionsSelected(collectionName);\n    }\n  }\n\n  // event handler for removing collection from cart\n  handleRemoveCollectionFromCart(event: CustomEvent) {\n    const { collectionName }: CollectionRemovedFromCartDetail =\n      event.detail as CollectionRemovedFromCartDetail;\n    this.removeCollectionFromCollectionsSelected(collectionName);\n  }\n\n  removeCollectionFromCollectionsSelected(collectionName: string) {\n    // create new collectionsSelected object excluding the deselected collection\n    const { [collectionName]: _, ...rest } = this.collectionsSelected;\n    this.collectionsSelected = { ...rest };\n  }\n\n  // event handler for pagination\n  handlePageChange(event: CustomEvent) {\n    this.currentPage = Number(event.detail);\n  }\n\n  // event handler for selecting facets\n  handleFacetSelected(event: CustomEvent) {\n    const facetName = (event.detail as { facetName: string }).facetName;\n    const facetFieldName = (\n      event.detail as { facetFieldName: keyof SelectedFacets }\n    ).facetFieldName;\n\n    this.selectedFacets = {\n      ...this.selectedFacets,\n      [facetFieldName]: [...this.selectedFacets[facetFieldName], facetName],\n    };\n\n    this.loadSearchResults();\n  }\n\n  // event handler for deselecting facets\n  handleFacetDeselected(event: CustomEvent) {\n    const facetName = (event.detail as { facetName: string }).facetName;\n    const facetFieldName = (\n      event.detail as { facetFieldName: keyof SelectedFacets }\n    ).facetFieldName;\n\n    // create new selectedFacets object, which is needed to update state and re-render\n    this.selectedFacets = {\n      ...this.selectedFacets,\n      [facetFieldName]: this.selectedFacets[facetFieldName].filter(\n        (value) => value !== facetName\n      ),\n    };\n\n    this.loadSearchResults();\n  }\n\n  private get filterQuery(): string[] {\n    return Object.entries(this.selectedFacets).flatMap(\n      ([facetFieldName, facetValues]: [string, string[]]) => {\n        // remove f_ prefix, eg. f_collectionName => collectionName\n        const searchableFieldName = facetFieldName.slice(2);\n\n        return facetValues.map(\n          (facetValue: string) => `${searchableFieldName}:\"${facetValue}\"`\n        );\n      }\n    );\n  }\n\n  // event handler for search term\n  private handleSearchClicked(event: CustomEvent) {\n    const searchText = (event.detail as { searchText: string }).searchText;\n    this.searchTerm = searchText;\n\n    this.loadSearchResults();\n  }\n\n  private get finalSearchTerm(): string {\n    return constructFinalSearchTerm(this.searchTerm, this.filterQuery);\n  }\n\n  private loadSearchFirstPage(): Promise<void> {\n    return this.performSearch(this.finalSearchTerm, this.itemsPerPage).then(\n      () => {\n        this.currentPage = 1;\n      }\n    );\n  }\n\n  private loadRemainingSearchResultsInBackground(): Promise<void> {\n    this.backgroundCollectionsLoaded = false;\n    return this.performSearch(\n      this.finalSearchTerm,\n      CollectionSurveyorSearchResults.MAX_COLLECTION_COUNT\n    ).then(() => {\n      this.backgroundCollectionsLoaded = true;\n    });\n  }\n\n  private static MAX_COLLECTION_COUNT = MAX_SOLR_ROWS;\n\n  private loadRemainingSearchResultsInBackgroundAndCacheData() {\n    this.performSearch(\"\", CollectionSurveyorSearchResults.MAX_COLLECTION_COUNT)\n      .then((allData: SolrData) => {\n        this.cachedCollections = allData.collections;\n        this.cachedFacets = allData.facets;\n        this.backgroundCollectionsLoaded = true;\n      })\n      .catch((error) => {\n        throw error;\n      });\n  }\n\n  private loadSearchResults() {\n    if (\n      // if empty search, use cached collections and facets for faster loading\n      this.finalSearchTerm === \"\" &&\n      this.cachedCollections !== undefined &&\n      this.cachedFacets !== undefined\n    ) {\n      this.collections = this.cachedCollections;\n      this.facets = this.cachedFacets;\n      this.currentPage = 1;\n    } else {\n      this.loadSearchFirstPage()\n        .then(() => this.loadRemainingSearchResultsInBackground())\n        .catch((error) => {\n          throw error;\n        });\n    }\n  }\n\n  private performSearch(\n    searchTerm: string,\n    rowCount: number\n  ): Promise<SolrData> {\n    this.isLoading = true;\n    return callSearchApi(searchTerm, rowCount)\n      .then((data: SolrData) => {\n        this.collections = data.collections;\n        this.facets = data.facets;\n        this.isLoading = false;\n        return data;\n      })\n      .catch((error) => {\n        this.isLoading = false;\n        throw error;\n      });\n  }\n\n  render() {\n    return html`\n      <!-- Collections Cart -->\n      <collection-surveyor-cart\n        .collectionsInCart=${this.collectionsSelected}\n        @collection-removed-from-cart=${this.handleRemoveCollectionFromCart}\n      ></collection-surveyor-cart>\n\n      <div class=\"search-facets-and-collections-container\">\n        <!-- Search Bar -->\n        <collection-surveyor-search-bar\n          .searchText=${this.searchTerm}\n          @search-clicked=\"${this.handleSearchClicked}\"\n        ></collection-surveyor-search-bar>\n\n        <!-- Facets and Collections-->\n        <div class=\"facets-and-collections-container\">\n          <!-- Loading icon -->\n            <div class=\"loading\">\n              ${this.isLoading ? html`<div class=\"spinner\"></div>` : html``}\n            </div>\n\n          ${\n            this.collectionsLength !== 0\n              ? html`\n                  <!-- Facets  -->\n                  <div class=\"facets-container\">\n                    <div>\n                      <h4>Narrow Your Results</h4>\n                      ${this.facets\n                        ? html` ${Object.entries(this.facets).map(\n                            ([key, value]) => html`\n                              <collection-surveyor-facet\n                                .facetField=${key}\n                                .facetFieldResults=${value}\n                                .selectedfacetFieldResults=${this\n                                  .selectedFacets[key as keyof SelectedFacets]}\n                                @facet-selected=${this.handleFacetSelected}\n                                @facet-deselected=${this.handleFacetDeselected}\n                              ></collection-surveyor-facet>\n                            `\n                          )}`\n                        : html`<p>No facets available</p>`}\n                    </div>\n                  </div>\n\n                  <!-- Collections -->\n                  <div class=\"collections-container\">\n                    <!-- Active Filters -->\n                    <collection-surveyor-active-filters\n                      .activeFilters=${this.selectedFacets}\n                      @facet-deselected=${this.handleFacetDeselected}\n                    ></collection-surveyor-active-filters>\n\n                    <!-- Pagination top of page -->\n                    <collection-surveyor-pagination\n                      .currentPage=\"${this.currentPage}\"\n                      .totalResults=\"${this.collectionsLength}\"\n                      .itemsPerPage=\"${this.itemsPerPage}\"\n                      .backgroundCollectionsLoaded=\"${this\n                        .backgroundCollectionsLoaded}\"\n                      @page-changed=\"${this.handlePageChange}\"\n                    ></collection-surveyor-pagination>\n\n                    <!-- Collections -->\n                    ${this.paginatedResults?.map(\n                      (collection) => html`\n                        <collection-surveyor-search-result\n                          .collection=${collection}\n                          .isSelected=${collection.collectionName in\n                          this.collectionsSelected}\n                          @update-collections-selected=\"${this\n                            .handleUpdateCollectionsSelected}\"\n                        ></collection-surveyor-search-result>\n                      `\n                    )}\n\n                    <!-- Pagination bottom of page -->\n                    <collection-surveyor-pagination\n                      .currentPage=\"${this.currentPage}\"\n                      .totalResults=\"${this.collectionsLength}\"\n                      .itemsPerPage=\"${this.itemsPerPage}\"\n                      .backgroundCollectionsLoaded=\"${this\n                        .backgroundCollectionsLoaded}\"\n                      @page-changed=\"${this.handlePageChange}\"\n                    ></collection-surveyor-pagination>\n                  </div>\n                `\n              : html``\n          }\n\n          ${\n            this.collectionsLength === 0 && !this.isLoading\n              ? html`\n                  <div class=\"no-results-message\">\n                    <h2>No Results Found For Your Search</h2>\n                    <p>Try a new search or clear your previous search</p>\n                    <p></p>\n                  </div>\n                `\n              : html``\n          }\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n  static styles = css`\n    .search-facets-and-collections-container {\n      box-shadow: rgb(136, 136, 136) 1px 1px 6px;\n      border-radius: 6px;\n      margin: 20px 50px;\n    }\n\n    .facets-and-collections-container {\n      display: flex;\n      background-color: rgb(248, 248, 248);\n      position: relative;\n    }\n\n    .facets-container {\n      display: flex;\n      padding: 10px 20px;\n      width: 40%;\n    }\n\n    .collections-container {\n      display: flex;\n      flex-direction: column;\n      padding: 10px 20px;\n      width: -webkit-fill-available;\n    }\n\n    .no-results-message {\n      margin: auto;\n      text-align: center;\n    }\n\n    .loading {\n      height: 100px;\n      padding-left: 50%;\n      position: absolute;\n    }\n\n    .spinner {\n      border: 4px solid rgba(0, 0, 0, 0.1);\n      border-left-color: #333;\n      border-radius: 50%;\n      width: 50px;\n      height: 50px;\n      animation: spin 1s linear infinite;\n    }\n\n    @keyframes spin {\n      to {\n        transform: rotate(360deg);\n      }\n    }\n  `;\n}\n\n@customElement(\"collection-surveyor-search-result\")\nexport class CollectionSurveyorSearchResult extends LitElement {\n  @property({ type: Object }) collection!: CollectionSearchResult;\n\n  @property({ type: Boolean }) isSelected = false;\n\n  @eventOptions({ capture: true })\n  handleAddToCartChange(event: Event) {\n    const button = event.target as HTMLInputElement;\n    const {\n      collectionId,\n      collectionName,\n      collectionSize,\n      organizationName,\n      createdDt,\n    } = button.dataset;\n\n    const customEvent = new CustomEvent(\"update-collections-selected\", {\n      detail: {\n        collectionSize,\n        collectionName,\n        collectionId,\n        organizationName,\n        createdDt,\n      },\n      bubbles: true,\n      composed: true,\n    });\n\n    this.dispatchEvent(customEvent);\n  }\n\n  render() {\n    return html`\n      <div class=\"result-item\">\n        <div class=\"item-detail\">\n          <div class=\"item-detail-text\">\n            <h3>\n              <a\n                href=\"https://archive-it.org/collections/${this.collection\n                  .collectionId}\"\n                target=\"_blank\"\n                >${this.collection.collectionName}</a\n              >\n            </h3>\n            <ul>\n              <li>\n                <span class=\"item-detail-label\"> Organization: </span>\n                ${this.collection.organizationName}\n              </li>\n              ${this.collection.meta_Description\n                ? html` <li>\n                    <span class=\"item-detail-label\"> Description: </span>\n                    ${this.collection.meta_Description[0]}\n                  </li>`\n                : nothing}\n              <li>\n                <span class=\"item-detail-label\"> Archived since: </span>\n                ${timestampStringToYearMonthString(this.collection.created_dt)}\n              </li>\n              <li>\n                <span class=\"item-detail-label\"> Collection Size: </span>\n                ${humanBytes(this.collection.totalWarcBytes)}\n              </li>\n            </ul>\n          </div>\n        </div>\n        <div class=\"collection-button\">\n          <button\n            type=\"button\"\n            data-collection-id=${this.collection.collectionId}\n            data-collection-name=${this.collection.collectionName}\n            data-collection-size=${this.collection.totalWarcBytes}\n            data-organization-name=${this.collection.organizationName}\n            data-created-dt=${this.collection.created_dt}\n            @click=${this.handleAddToCartChange}\n          >\n            ${this.isSelected ? \"Remove from cart\" : \"Add to cart\"}\n          </button>\n        </div>\n      </div>\n    `;\n  }\n\n  static styles = css`\n    .result-item {\n      background-color: rgb(255, 255, 255);\n      border-radius: 6px;\n      box-shadow: rgb(136, 136, 136) 1px 1px 6px;\n      margin-bottom: 15px;\n      display: flex;\n      justify-content: space-around;\n    }\n\n    .item-detail {\n      padding: 1em 0 1em 1em;\n      display: inline-block;\n      width: 75%;\n    }\n\n    .item-detail-text h2,\n    .item-detail-text h3 {\n      padding: 0;\n      margin: 0;\n    }\n\n    .item-detail-text ul {\n      list-style-type: none;\n      padding: 0;\n      margin: 0;\n    }\n\n    .item-detail-text ul li {\n      margin: 0.6em 0;\n      line-height: 1.25;\n    }\n\n    .item-detail-text .item-detail-label {\n      font-weight: bold;\n    }\n\n    .collection-button {\n      display: inline-block;\n      vertical-align: top;\n      padding: 1em;\n    }\n\n    button {\n      width: 130px;\n    }\n\n    a {\n      color: #c9540a;\n    }\n  `;\n}\n","import{decorateProperty as r}from\"./base.js\";\n/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */function e(e){return r({finisher:(r,t)=>{Object.assign(r.prototype[t],e)}})}export{e as eventOptions};\n//# sourceMappingURL=event-options.js.map\n"],"names":["t","r","state","o","finisher","e","descriptor","n","originalKey","key","i","kind","placement","constructor","Object","defineProperty","CSRF_REGEX","getCsrfHeader","csrfMatch","exec","decodeURIComponent","document","cookie","callSearchApi","finalSearchTerm","rowCount","options","request","method","headers","Accept","body","JSON","stringify","fetch","url","then","response","ok","json","Error","errorMessage","catch","error","console","Promise","reject","callJsonApi","encodeURIComponent","CollectionSurveyorSearchResults","CollectionSurveyorSearchResults_1","LitElement","this","collections","undefined","cachedCollections","facets","cachedFacets","isLoading","backgroundCollectionsLoaded","collectionsSelected","selectedFacets","f_organizationName","f_organizationType","searchTerm","currentPage","itemsPerPage","connectedCallback","super","loadSearchFirstPage","loadRemainingSearchResultsInBackgroundAndCacheData","collectionsLength","length","startIndex","endIndex","paginatedResults","_a","slice","handleUpdateCollectionsSelected","event","collectionSize","collectionName","collectionId","organizationName","createdDt","detail","removeCollectionFromCollectionsSelected","sizeIdMap","handleRemoveCollectionFromCart","_","rest","handlePageChange","Number","handleFacetSelected","facetName","facetFieldName","loadSearchResults","handleFacetDeselected","filter","value","filterQuery","entries","flatMap","facetValues","searchableFieldName","map","facetValue","handleSearchClicked","searchText","parsedFilters","join","performSearch","loadRemainingSearchResultsInBackground","MAX_COLLECTION_COUNT","allData","data","render","html","collection","styles","css","__decorate","prototype","property","type","customElement","CollectionSurveyorSearchResult","isSelected","handleAddToCartChange","button","target","dataset","customEvent","CustomEvent","bubbles","composed","dispatchEvent","meta_Description","nothing","timestampStringToYearMonthString","created_dt","humanBytes","totalWarcBytes","Boolean","assign","eventOptions","capture"],"mappings":"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"}